<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage · GasChromatographySimulator.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="GasChromatographySimulator.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">GasChromatographySimulator.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li class="is-active"><a class="tocitem" href>Usage</a><ul class="internal"><li><a class="tocitem" href="#Option-parameters"><span>Option parameters</span></a></li><li><a class="tocitem" href="#GC-Column-parameters"><span>GC Column parameters</span></a></li><li><a class="tocitem" href="#Program-parameters"><span>Program parameters</span></a></li><li><a class="tocitem" href="#Substance-parameters"><span>Substance parameters</span></a></li><li><a class="tocitem" href="#Combining-the-parameters"><span>Combining the parameters</span></a></li><li><a class="tocitem" href="#Run-the-simulation-and-evaluate-the-results"><span>Run the simulation and evaluate the results</span></a></li><li><a class="tocitem" href="#Notes"><span>Notes</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../additional/">Additional features</a></li><li><a class="tocitem" href="../functions/">Functions</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Usage</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/GasChromatographyToolbox/GasChromatographySimulator.jl/blob/main/docs/src/usage.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h1><p>In the following section the general usage and setup of the simulation is explained. </p><p>A GC-system for the simulation is defined by four sets of parameters:</p><h2 id="Option-parameters"><a class="docs-heading-anchor" href="#Option-parameters">Option parameters</a><a id="Option-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Option-parameters" title="Permalink"></a></h2><p>A fourth set of parameters, <a href="../functions/#GasChromatographySimulator.Options"><code>GasChromatographySimulator.Options</code></a>, holds additional options used in the simulation with the following arguments:</p><ul><li><code>alg</code>: The algorithm used for the ODE solver. The algorithms <code>OwrenZen3()</code>, <code>OwrenZen4()</code> and <code>OwrenZen5()</code> are recommended.</li><li><code>abstol</code>: The absolute tolerance for the ODE solver. Recommended value 1e-6 to 1e-8.</li><li><code>reltol</code>: The relative tolerance for the ODE solver. Recommended value 1e-3 to 1e-5. </li><li><code>Tcontrol</code>: Option defining at which point of the column the temperature program is calculated. The options are <code>inlet</code> (x=0) and <code>outlet</code> (x=L).</li><li><code>odesys</code>: Combine the ODEs for migration and peak-width into a system of ODEs (<code>odesys = true</code>) or solve the two ODEs separately (<code>odesys = false</code>).</li><li><code>ng</code>: Option to calculate the simulation without a gradient (<code>ng = true</code>, uniform <code>T</code>, <code>d</code> and <code>df</code>) or with a gradient (<code>ng = false</code>, non-uniform <code>T</code>, <code>d</code> and/or <code>df</code>). </li><li><code>vis</code>: Used model of viscosity. <code>HP</code> is a model taken from the HP flow calculator with a linear temperature dependency of the viscosity. <code>Blumberg</code> is an emperical formula according to the book <a href="https://GasChromatographyToolbox.github.io/GasChromatographySimulator.jl/dev/references/#References"><code>[7]</code></a></li><li><code>control</code>: Control of the &quot;Flow&quot; or of the &quot;Pressure&quot; (at column inlet) during the program</li></ul><p>The default options can be initialized by calling:</p><pre><code class="language-julia hljs">opt = GasChromatographySimulator.Options()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GasChromatographySimulator.Options(OwrenZen5(; stage_limiter! = trivial_limiter!, step_limiter! = trivial_limiter!, thread = static(false),), 1.0e-6, 0.001, &quot;inlet&quot;, true, false, &quot;Blumberg&quot;, &quot;Pressure&quot;, 1.0e12)</code></pre><h2 id="GC-Column-parameters"><a class="docs-heading-anchor" href="#GC-Column-parameters">GC Column parameters</a><a id="GC-Column-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#GC-Column-parameters" title="Permalink"></a></h2><p>A GC column is defined by the dimensions of the column, length <code>L</code>, diameter <code>d</code> and film thickness of the stationary phase <code>df</code>, all measured in meters, the name of the stationary phase and the name of the mobile phase (with the allowed values &quot;He&quot;, &quot;H2&quot; and &quot;N2&quot;).</p><p><img src="../assets/column.png" alt="GC-column"/></p><p>These values are collected in the type structure <a href="../functions/#GasChromatographySimulator.Column"><code>GasChromatographySimulator.Column</code></a>, which allows to define a function depending on column position <code>x</code> of the diameter <code>d(x, a_d)</code> and film thickness <code>df(x, a_df)</code>, where <code>a_d</code>, resp. <code>a_df</code> are parameters of the function.</p><p>The following method constructs the Column structure <code>col</code> with an uniform diameter and uniform film thickness:</p><pre><code class="language-julia hljs">col = GasChromatographySimulator.Column(10.0, 0.25e-3, 0.25e-6, &quot;SPB50&quot;, &quot;He&quot;)</code></pre><h2 id="Program-parameters"><a class="docs-heading-anchor" href="#Program-parameters">Program parameters</a><a id="Program-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Program-parameters" title="Permalink"></a></h2><p>The program for a GC separation is defined by a temperature program <span>$T(t)$</span> and a pressure program. Typically (option <code>control = &quot;Pressure&quot;</code>) the inlet pressure is controlled over time <span>$p_{in}(t)$</span> and the outlet pressure is constant, but here the outlet pressure can also be a function of time <span>$p_{out}(t)$</span>. It is also possible to control the flow <span>$F(t)$</span> through the column (option <code>control = Flow</code>) instead of the inlet pressure. In this case the values of the flow (in m³/s) replace the values of the inlet pressure in the following definitions. In addition a thermal gradient can be applied, where the temperature of the GC column changes depending on position <span>$x$</span> on the column.</p><p>The program parameters are collected in the type structure <a href="../functions/#GasChromatographySimulator.Program"><code>GasChromatographySimulator.Program</code></a>.</p><p>Different methods exist to construct the Program structure, depending on the usage of a thermal gradient. In two examples the definition of the program parameters will be explained.</p><h3 id="Without-thermal-gradient"><a class="docs-heading-anchor" href="#Without-thermal-gradient">Without thermal gradient</a><a id="Without-thermal-gradient-1"></a><a class="docs-heading-anchor-permalink" href="#Without-thermal-gradient" title="Permalink"></a></h3><p>Without a thermal gradientthe temperature is the same at every column position (uniform) at the same time. This is the normal case for conventional GC. One example of such a program can be achieved by the following method <a href="../functions/#GasChromatographySimulator.Program"><code>GasChromatographySimulator.Program(time_steps, temp_steps, pin_steps, pout_steps, L)</code></a>, which constructs the Program structure:</p><pre><code class="language-julia hljs">prog = GasChromatographySimulator.Program(  [0.0, 60.0, 600.0, 120.0],
                                            [40.0, 40.0, 300.0, 300.0],
                                            [18.0, 18.0, 98.0, 98.0].*1000.0 .+ 101300.0,
                                            101300.0.*ones(4),
                                            col.L)</code></pre><p>The first array <code>time_steps</code> defines the time steps (in s), the second array <code>temp_steps</code> defines the temperatures (in °C) at these time steps, the third and fourth array (<code>pin_steps</code> and <code>pout_steps</code>; resp. <code>F_steps</code> and <code>pout_steps</code> if the option <code>control = &quot;Flow&quot;</code>) define the inlet and outlet pressures (both in Pa(absolute)) at the time steps. The values of temperature and pressures change linearly between the values defined at the time steps. The following picture shows the resulting temperature and pressure program:</p><p><img src="../assets/prog_nograd.svg" alt="Program without thermal gradient"/></p><p>The first time step is always zero (t₁ = 0.0 s) and the following time steps define the time that passes until the next step. In the example the second time step is t₂ = 60 seconds long and in this time the temperature stays constant at 40°C. With the next time step (t₃ = 600 s) the temperature changes from T₂ = 40°C linearly to T₃ = 300°C. In the last time step (t₄ = 120 s) the temperature is again kept constant at 300°C. The pressure program is defined in the same way. The inlet pressure changes similarly at the time steps, while the outlet pressure is constant.</p><p>The four arrays for time steps, temperatures and the two pressures (or flow and outlet pressure) must have the same number of elements, otherwise the construction of the Program structure gives an error message. Complex programs with several different heating ramps and temperature plateaus, as well as programed pressures, e.g. pressure pulses, can be realized by adding the temperature/pressure values at additional time steps. </p><h4 id="Conventional-program-notation"><a class="docs-heading-anchor" href="#Conventional-program-notation">Conventional program notation</a><a id="Conventional-program-notation-1"></a><a class="docs-heading-anchor-permalink" href="#Conventional-program-notation" title="Permalink"></a></h4><p>In the control software of most commercial gas chromatographs the program is defined by temperature levels <span>$T_i$</span>, holding times <span>$t_i$</span> of the temperature levels and heating ramps <span>$r_i$</span> between the temperature levels. These programs can be written for a program with <span>$n$</span> temperature levels and <span>$n-1$</span> heating ramps as:</p><p><span>$T_1(t_1) - r_1 - T_2(t_2) - r_2 - T_3(t_3) - ... - r_{n-1} - T_n(t_n)$</span></p><p>With the function <a href="../functions/#GasChromatographySimulator.conventional_program-Tuple{Any}"><code>GasChromatographySimulator.conventional_program</code></a> such a conventional program notation can be translated into the program notation used in this simulation. Hereby is <code>CP</code> a vector of the form <code>[T₁, t₁, r₁, T₂, t₂, r₂, T₃, t₃, ...]</code>.</p><pre><code class="language-julia hljs">CP = [40.0, 1.0, 5.0, 280.0, 2.0, 20.0, 320.0, 2.0]
ts, Ts = GasChromatographySimulator.conventional_program(CP)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Real[0.0, 60.0, 2880.0, 120.0, 120.0, 120.0], Real[40.0, 40.0, 280.0, 280.0, 320.0, 320.0])</code></pre><p>With the function <a href="../functions/#GasChromatographySimulator.temperature_program-Tuple{Any, Any}"><code>GasChromatographySimulator.temperature_program(time_steps, value_steps; time_unit=&quot;min&quot;)</code></a> the used program with time steps and temperature steps can be translated into the conventional program notation.</p><pre><code class="language-julia hljs">TP = GasChromatographySimulator.temperature_program(ts, Ts; time_unit=&quot;min&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{Real}:
  40.0
   1.0
   5.0
 280.0
   2.0
  20.0
 320.0
   2.0</code></pre><p>These functions can also be used for the notation of other programs, e.g. programs of the inlet pressure.</p><h3 id="Thermal-gradient"><a class="docs-heading-anchor" href="#Thermal-gradient">Thermal gradient</a><a id="Thermal-gradient-1"></a><a class="docs-heading-anchor-permalink" href="#Thermal-gradient" title="Permalink"></a></h3><h4 id="Predefined-gradient-function"><a class="docs-heading-anchor" href="#Predefined-gradient-function">Predefined gradient function</a><a id="Predefined-gradient-function-1"></a><a class="docs-heading-anchor-permalink" href="#Predefined-gradient-function" title="Permalink"></a></h4><p>In the following text the expression <em>temperature program</em> means the change of the temperature with time <code>t</code> (dynamic), while the expression <em>temperature gradient</em> means the change of the temperature with column position <code>x</code> (non-uniform).</p><p>In addition to a linear temperature and pressure program , a temperature gradient can be defined. Using the method <a href="../functions/#GasChromatographySimulator.Program"><code>GasChromatographySimulator.Program(time_steps, temp_steps, pin_steps, pout_steps, a_gf, Tcontrol, L)</code></a> a pre-defined temperature function <code>gf(x)</code> is used to set the GC program.</p><pre><code class="language-julia hljs">prog_g = GasChromatographySimulator.Program([0.0, 60.0, 150.0, 150.0, 120.0],
                                            [40.0, 40.0, 170.0, 300.0, 300.0],
                                            150000.0.*ones(5),
                                            101300.0.*ones(5),
                                            [[0.0, 0.0, 60.0, 60.0, 20.0] zeros(5) col.L.*ones(5) [0.0, 0.0, -2.0, -5.0, -5.0]],
                                            &quot;inlet&quot;,
                                            col.L)</code></pre><p>Similar to the setup before, the arrays <code>time_steps</code>, <code>temp_steps</code>, <code>pin_steps</code> (resp. <code>F_steps</code>, if option <code>control = &quot;Flow&quot;</code>) and <code>pout_steps</code> are used. Added are the the array <code>a_gf</code>, containing the parameters for the temperature function <code>gf(x)</code> and the option <code>Tcontrol</code> (with options &quot;inlet&quot; and &quot;outlet&quot;), which defines at which position of the column the temperature program is defined (<code>Tcontrol = &quot;inlet&quot;</code> ... temperature program defined at <code>x=0</code>; <code>Tcontrol=&quot;outlet&quot;</code> ... temperature program defined at <code>x=L</code>). The following picture shows the resulting temperature program at the column inlet and outlet:</p><p><img src="../assets/prog_grad.svg" alt="Program with thermal gradient"/></p><p>The parameters of the pre-defined gradient function <code>gf(x)</code> consists of four arrays with the same length as the array <code>time_steps</code>. These four arrays represent four different parameters:</p><ul><li><code>ΔT</code> ... the temperature difference between <code>x = x₀</code> and <code>x = x₀ + L₀</code></li><li><code>x₀</code> ... the start position, typically <code>x₀ = 0.0</code></li><li><code>L₀</code> ... the distance from the start position, typically <code>L₀ = L</code></li><li><code>α</code> ... the gradient profile factor</li></ul><p>The form of the gradient function can change over time. For every parameter the same number of values as the number of <code>time_steps</code> are defined and different gradient functions at the different <code>time_steps</code> are defined. For times between the <code>time_steps</code> the gradient function at a fixed position changes linearly in time between the values at the surrounding <code>time_steps</code>. </p><p>The pre-defined gradient function distinguishes two cases for the gradient profile factor. For <code>α&lt;=0</code> it is defined as</p><p><span>$gf(x) = ΔT  \left( 1 - \exp{\left(α \left( 1 - \frac{x - x_0}{L_0}\right)\right)} + \left(1 - \frac{x - x_0}{L_0}\right) \exp{(α)}\right)$</span></p><p>For <code>α&gt;0</code> it is defined as</p><p><span>$gf(x) = ΔT  \left(\exp{\left(-α \frac{x - x_0}{L_0}\right)} - \frac{x - x_0}{L_0}\exp{(-α)}\right)$</span></p><p>The following graph shows different gradient functions for different profile factors <code>α</code> (<code>ΔT = 50°C</code>, <code>x₀ = 0.0m</code> and <code>L₀ = 10.0m</code>). </p><p><img src="../assets/grad_alpha.svg" alt="Temperature gradient with different profile factors"/></p><p>For <code>α=0</code> a linear change of the temperature along the column is achieved. For negative <code>α</code>-values the gradient has a concave profile, with small changes of the temperature near the inlet and great changes towards the outlet. For positive <code>α</code>-values the gradient has a convex profile, with great changes near the inlet and small changes towards the outlet.</p><p>From the parameters <code>time_steps</code>, <code>temp_steps</code>, <code>a_gf</code> and gradient function <code>gf(x)</code> the temperature at every position <code>x</code> and every time <code>t</code> is linearly interpolated in a function <code>T_itp(x,t)</code>, which is stored in the <a href="../functions/#GasChromatographySimulator.Program"><code>GasChromatographySimulator.Program</code></a> structure. The parameters <code>time_steps</code> and <code>pin_steps</code>, resp. <code>pout_steps</code>, are used to construct the linear interpolated pressure function in time <code>pin_itp(t)</code>, resp. <code>pout_itp(t)</code>. These interpolated functions are used throughout the simulation.</p><p>In the section <a href="#Self-defined-gradient-function">Self-defined gradient function</a> in <a href="#Notes">Notes</a> an example for a user defined gradient function is shown.</p><h2 id="Substance-parameters"><a class="docs-heading-anchor" href="#Substance-parameters">Substance parameters</a><a id="Substance-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Substance-parameters" title="Permalink"></a></h2><p>A third set of parameters, <a href="../functions/#GasChromatographySimulator.Substance"><code>GasChromatographySimulator.Substance</code></a>, is used to store the informations about the substances which are separated in the simulated GC-run. The stored information are the name, the CAS-number, three thermodynamic parameters (<code>Tchar</code> <code>θchar</code> <code>ΔCp</code>, see also <a href="https://GasChromatographyToolbox.github.io/GasChromatographySimulator.jl/dev/references/#References"><code>[6]</code></a>), the dimensionless film thickness (df/d) of the Column for which the thermodynamic parameters were estimated, the diffusivity (calculated from the molecular formula, number of rings in the molecule and mol mass, which are extracted using <a href="https://github.com/longemen3000/ChemicalIdentifiers.jl">ChemicalIdentifiers.jl</a> from an external database), the injection time and initial peak width. For several substances an array of the type <a href="../functions/#GasChromatographySimulator.Substance"><code>GasChromatographySimulator.Substance</code></a> is used.</p><p>With the function <a href="../functions/#GasChromatographySimulator.load_solute_database"><code>GasChromatographySimulator.load_solute_database</code></a> the data for selected substances and a selected stationary phase is loaded from an external database (a .csv-file).</p><pre><code class="language-julia hljs">stat_phase = col.sp
solutes = [&quot;C10&quot;, &quot;C11&quot;, &quot;C12&quot;, &quot;2-Octanol&quot;, &quot;2-Octanone&quot;]
t₀ = zeros(length(solutes))
τ₀ = zeros(length(solutes))
sub = GasChromatographySimulator.load_solute_database(&quot;../../data&quot;, &quot;Database_test.csv&quot;,
                                                        stat_phase,
                                                        col.gas,
                                                        solutes,
                                                        t₀,
                                                        τ₀)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{GasChromatographySimulator.Substance}:
 GasChromatographySimulator.Substance(&quot;Decane&quot;, &quot;124-18-5&quot;, 364.279, 28.227, 66.861, 0.001, &quot;Blumberg2017, ketone, alkanones, No: 4&quot;, 9.559792505937433e-5, 0.0, 0.0)
 GasChromatographySimulator.Substance(&quot;Undecane&quot;, &quot;1120-21-4&quot;, 382.09999999999997, 29.003, 74.488, 0.001, &quot;Blumberg2017, alcohol, No: 6&quot;, 9.077143786246931e-5, 0.0, 0.0)
 GasChromatographySimulator.Substance(&quot;Dodecane&quot;, &quot;112-40-3&quot;, 398.66999999999996, 29.71, 80.744, 0.001, &quot;Blumberg2017, alcohol, No: 11&quot;, 8.655692452901932e-5, 0.0, 0.0)
 GasChromatographySimulator.Substance(&quot;2-Octanol&quot;, &quot;123-96-6&quot;, 380.27, 29.065, 78.13, 0.001, &quot;Blumberg2017, alkane, Grob, alkanes, No: 5&quot;, 0.00010555800362911222, 0.0, 0.0)
 GasChromatographySimulator.Substance(&quot;2-Octanone&quot;, &quot;111-13-7&quot;, 383.84999999999997, 29.424, 76.479, 0.001, &quot;Blumberg2017, alcohol, Grob, alcohols, No: 7&quot;, 0.00010710208339087157, 0.0, 0.0)</code></pre><p>An example database <a href="https://github.com/GasChromatographyToolbox/GasChromatographySimulator.jl/blob/main/data/Database_test.csv"><code>Database_test.csv</code></a> with thermodynamic data from <a href="https://GasChromatographyToolbox.github.io/GasChromatographySimulator.jl/dev/references/#References"><code>[6]</code></a> can be found in the folder <code>/data</code> of this github project, see also <a href="#Database"><code>Database</code></a>.</p><h2 id="Combining-the-parameters"><a class="docs-heading-anchor" href="#Combining-the-parameters">Combining the parameters</a><a id="Combining-the-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Combining-the-parameters" title="Permalink"></a></h2><p>The four sets of parameters defining the simulation are collected in the type structure <a href="../functions/#GasChromatographySimulator.Parameters"><code>GasChromatographySimulator.Parameters</code></a>. All information for the simulation are contained in this structure.</p><pre><code class="language-julia hljs">par_g = GasChromatographySimulator.Parameters(col, prog_g, sub, opt)</code></pre><h2 id="Run-the-simulation-and-evaluate-the-results"><a class="docs-heading-anchor" href="#Run-the-simulation-and-evaluate-the-results">Run the simulation and evaluate the results</a><a id="Run-the-simulation-and-evaluate-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Run-the-simulation-and-evaluate-the-results" title="Permalink"></a></h2><p>The GC-system is simulated by numerically solving two ordinary differential equations (ODE):</p><p>The first ODE describes the migration <span>$t(x)$</span> of a substance through the GC column with the velocity <span>$u(x,t)$</span>:</p><p><span>$\frac{dt}{dx} = \frac{1}{u(x,t)}$</span></p><p>The second ODE describes the development of the temporal peak variance <span>$\tau^2(x,t(x))$</span> during the migration:</p><p><span>$\frac{dτ^2}{dx} = H(x, t(x)) r(x, t(x)) + 2 τ^2(x, t(x)) \frac{∂r}{∂t}(x,t(x))$</span></p><p>Hereby is <span>$r(x,t)$</span> the inverse velocity of the substance (<span>$1/u(x,t)$</span>, also called residency) and <span>$H(x,t)$</span> is the local plate height. For more information about the physical model see the <a href="https://GasChromatographyToolbox.github.io/GasChromatographySimulator.jl/dev/functions/#Physical-Model"><code>docstrings of the physical model</code></a> and the references <a href="https://GasChromatographyToolbox.github.io/GasChromatographySimulator.jl/dev/references/#References"><code>[7]</code></a> and <a href="https://GasChromatographyToolbox.github.io/GasChromatographySimulator.jl/dev/references/#References"><code>[8]</code></a>.</p><p>With the argument <code>odesys</code> of <a href="../functions/#GasChromatographySimulator.Options"><code>GasChromatographySimulator.Options</code></a> the two differential equations can be solved as a system of ODEs (<code>odesys = true</code>) or separately, using the solution of the first ODE to solve the second ODE (<code>odesys = false</code>).   </p><p>With the function <a href="../functions/#GasChromatographySimulator.simulate"><code>GasChromatographySimulator.simulate</code></a> the simulation is initiated.</p><p>An example of the above defined GC Column <code>col</code>, with a temperature gradient program <code>prog_g</code>, the five substances <code>sub</code> and the default options <code>opt</code> (collected in the parameters <code>par_g</code>) is simulated by </p><pre><code class="language- hljs">peaklist, sol = GasChromatographySimulator.simulate(par_g)
nothing # hide</code></pre><p>The simulation gives two resulting quantities. In the <code>peaklist</code> the general results of the simulated GC-run are presented in a DataFrame:</p><pre><code class="language- hljs">peaklist # hide</code></pre><ul><li>Name          ... name of the substance</li><li>tR            ... retention time in s</li><li>τR            ... peak width at retention time in s</li><li>TR            ... elution temperature (temperature of the column outlet at retention time) </li><li>σR            ... band width at retention time in m</li><li>uR            ... velocity of the substance at retention time in m/s</li><li>kR            ... retention factor at retention time</li><li>Res           ... resolution between the substance and its following neighbor</li><li>Δs            ... separation metric between the substance and its following neighbor</li></ul><p>From the <code>peaklist</code> a chromatogram can be calculated (gaussian peak form with the same area are assumed) and plotted:</p><pre><code class="language- hljs">using Plots; gr() # hide
p_chrom, t, abundance = GasChromatographySimulator.plot_chromatogram(peaklist, (100.0, 200.0))
savefig(p_chrom, &quot;plot_chromatogram.png&quot;); nothing # hide</code></pre><p><img src="plot_chromatogram.png" alt/></p><p>The solution of the ODEs are stored in <code>sol</code> as an array of solutions from the <a href="https://github.com/SciML/DifferentialEquations.jl"><code>DifferentialEquations.jl</code></a> package. The solution for the first substance (C10) is:</p><pre><code class="language- hljs">sol[1] # hide</code></pre><p>Herby is <code>sol[1].t</code> the position <code>x</code> along the column and <code>sol[1].u</code> consists of an array of the corresponding time <code>t</code> and peak variance <code>τ²</code>.</p><p>The solution <code>t(x)</code> can be plotted by</p><pre><code class="language- hljs">p_tx = plot(sol[1], vars=1)
savefig(p_tx, &quot;plot_tx.png&quot;); nothing # hide</code></pre><p><img src="plot_tx.png" alt/></p><p>The solution <code>τ²(x)</code> can be plotted by</p><pre><code class="language- hljs">p_τ²x = plot(sol[1], vars=2)
savefig(p_τ²x, &quot;plot_tau2x.png&quot;); nothing # hide</code></pre><p><img src="plot_tau2x.png" alt/></p><p>The function <a href="../functions/#GasChromatographySimulator.local_plots"><code>GasChromatographySimulator.local_plots</code></a> can be used to plot different quantities, e.g. position <code>x</code>, time <code>t</code>, peak width <code>τ</code>, (spatial) band width <code>σ</code>, velocity of the substance <code>u</code> or the temperature at the position of the substance <code>T</code>.</p><pre><code class="language- hljs">p_σ_t = GasChromatographySimulator.local_plots(&quot;t&quot;, &quot;σ&quot;, sol, par_g)
savefig(p_σ_t, &quot;plot_sigma_t.png&quot;); nothing # hide</code></pre><p><img src="plot_sigma_t.png" alt/></p><h2 id="Notes"><a class="docs-heading-anchor" href="#Notes">Notes</a><a id="Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Notes" title="Permalink"></a></h2><h3 id="Self-defined-gradient-function"><a class="docs-heading-anchor" href="#Self-defined-gradient-function">Self-defined gradient function</a><a id="Self-defined-gradient-function-1"></a><a class="docs-heading-anchor-permalink" href="#Self-defined-gradient-function" title="Permalink"></a></h3><p>It is possible to define other gradient function beside the pre-defined function above. The following example shows the construction of the <a href="../functions/#GasChromatographySimulator.Program"><code>GasChromatographySimulator.Program</code></a> structure with a <code>sin</code> function with a changing period over the time of the program:</p><pre><code class="language-julia hljs">L = 10.0
time_steps = [0.0, 60.0, 150.0, 150.0, 120.0]
temp_steps = [40.0, 60.0, 170.0, 300.0, 350.0]
pin_steps = 150000.0.*ones(length(time_steps))
pout_steps = zeros(length(time_steps))
a_gf = [[10.0, 10.0, 30.0, 30.0, 10.0] [1.0, 1.0, 1.0, 2.0, 4.0]]
gradient_function(x) = a_gf[:,1].*sin.(a_gf[:,2].*2*π/L*x)
T_itp = GasChromatographySimulator.temperature_interpolation(time_steps, temp_steps, gradient_function, L)
pin_itp = GasChromatographySimulator.pressure_interpolation(time_steps, pin_steps)
pout_itp = GasChromatographySimulator.pressure_interpolation(time_steps, pout_steps)
prog = GasChromatographySimulator.Program(time_steps, temp_steps, pin_steps, pout_steps, gradient_function, a_gf, T_itp, pin_itp, pout_itp)</code></pre><p>This program results in the following gradient.</p><p><img src="../assets/grad_sin.svg" alt="self-defined thermal gradient"/></p><p>The solid lines show the defined gradient functions at the five <code>time_steps</code>. The two dashed lines show the gradient at two different times between the third and fourth <code>time_steps</code>. They show the transition between the two defined functions.</p><p>Note: Not fully tested yet.</p><h3 id="Database"><a class="docs-heading-anchor" href="#Database">Database</a><a id="Database-1"></a><a class="docs-heading-anchor-permalink" href="#Database" title="Permalink"></a></h3><p>The layout of the database in the .csv-file is shown here:</p><pre><code class="language-julia hljs">db = DataFrame(CSV.File(&quot;../../data/Database_test.csv&quot;, header=1, silencewarnings=true, limit=3))</code></pre><div><div style = "float: left;"><span>3×11 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Name</th><th style = "text-align: left;">CAS</th><th style = "text-align: left;">Phase</th><th style = "text-align: left;">Tchar</th><th style = "text-align: left;">thetachar</th><th style = "text-align: left;">DeltaCp</th><th style = "text-align: left;">phi0</th><th style = "text-align: left;">Source</th><th style = "text-align: left;">Cat_1</th><th style = "text-align: left;">Cat_2</th><th style = "text-align: left;">Cat_3</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String15" style = "text-align: left;">String15</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "InlineStrings.String15" style = "text-align: left;">String15</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Missing" style = "text-align: left;">Missing</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">Heptane</td><td style = "text-align: left;">142-82-5</td><td style = "text-align: left;">SLB5ms</td><td style = "text-align: right;">44.738</td><td style = "text-align: right;">25.519</td><td style = "text-align: right;">60.91</td><td style = "text-align: right;">0.001</td><td style = "text-align: left;">Blumberg2017</td><td style = "text-align: left;">alkane</td><td style = "text-align: left;">alkanes</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">Octane</td><td style = "text-align: left;">111-65-9</td><td style = "text-align: left;">SLB5ms</td><td style = "text-align: right;">67.346</td><td style = "text-align: right;">26.779</td><td style = "text-align: right;">66.363</td><td style = "text-align: right;">0.001</td><td style = "text-align: left;">Blumberg2017</td><td style = "text-align: left;">alkane</td><td style = "text-align: left;">alkanes</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">Nonane</td><td style = "text-align: left;">111-84-2</td><td style = "text-align: left;">SLB5ms</td><td style = "text-align: right;">87.42</td><td style = "text-align: right;">27.699</td><td style = "text-align: right;">71.797</td><td style = "text-align: right;">0.001</td><td style = "text-align: left;">Blumberg2017</td><td style = "text-align: left;">alkane</td><td style = "text-align: left;">alkanes</td><td style = "font-style: italic; text-align: right;">missing</td></tr></tbody></table></div><p>It consists of 14 different columns:</p><ul><li>Name          ... name of the substance</li><li>CAS           ... CAS number for unique identification of the substance</li><li>Phase         ... name of the stationary phase which corresponds to the thermodynamic parameters</li><li>Tchar         ... the first thermodynamic parameter in °C</li><li>thetachar     ... the second thermodynamic parameter in °C</li><li>DeltaCp       ... the third thermodynamic parameter in J mol⁻¹ K⁻¹</li><li>phi0          ... the dimensionless film thickness (df/d) for which the thermodynamic parameters were estimated</li><li>Source        ... a note, e.g. reference for the thermodynamic parameters</li><li>Cat           ... a number of columns with optional names for categories of the substances</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation/">« Installation</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 29 June 2024 20:11">Saturday 29 June 2024</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
